pipeline {
    agent any

    tools {
        nodejs 'nodejs25'
        maven  'maven3'
        'dependency-check' 'odc'
        'hudson.plugins.sonar.SonarRunnerInstallation' 'sonarqube-scanner'
        dockerTool 'docker-latest'
    }

    environment {
        AWS_ACCESS_KEY_ID     = credentials('aws-creds')
        AWS_SECRET_ACCESS_KEY = credentials('aws-creds')
        DOCKER_USERNAME       = credentials('docker-creds')
        DOCKER_PASSWORD       = credentials('docker-creds')
        SONAR_TOKEN           = credentials('sonar-creds')
    }

    stages {

        stage('Checkout Code') {
            steps {
                cleanWs()
                git branch: 'main',
                    url: 'https://github.com/Tejas886/Book-My-Show-Project-Caps.git'
            }
        }

        stage('Install Dependencies Fast') {
            steps {
                sh 'npm install --silent'
            }
        }

        stage('SonarQube Analysis') {
            steps {
                withSonarQubeEnv('sonarqube') {
                    sh """
                       sonar-scanner \
